<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>每日生活助手</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <div class="max-w-md mx-auto p-6 bg-white rounded-xl shadow-md">
      <h1 class="text-2xl font-bold text-center mb-6">今日推荐</h1>
      
      <div v-if="loading" class="text-center py-4">
        <p>加载中...</p>
      </div>
      
      <div v-if="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <p>{{ error }}</p>
      </div>
      
      <div v-if="!loading && !error">
        <div class="mb-4">
          <h2 class="font-semibold">运势</h2>
          <p class="text-gray-600">{{ fortune.wealth }}</p>
          <p class="text-gray-600">{{ fortune.love }}</p>
          <p class="text-green-500">幸运色: {{ fortune.lucky_color }}</p>
        </div>
        
        <div class="mb-4">
          <h2 class="font-semibold">穿衣</h2>
          <p>{{ outfit }}</p>
          <img v-if="outfitImage" :src="outfitImage" class="mt-2 w-full rounded-lg" alt="穿搭图片">
        </div>
        
        <div class="mb-4">
          <h2 class="font-semibold">饮食</h2>
          <p>{{ diet }}</p>
        </div>
      </div>
      
      <!-- 调试信息 -->
      <div v-if="debugInfo" class="mt-4 p-2 bg-gray-100 rounded">
        <h3 class="font-semibold">调试信息:</h3>
        <pre class="text-xs">{{ debugInfo }}</pre>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          fortune: {},
          outfit: "",
          outfitImage: "",
          diet: "",
          loading: true,
          error: null,
          debugInfo: null
        }
      },
      async mounted() {
        try {
          // 设置调试信息
          this.debugInfo = "开始加载数据...";
          
          // 从后端获取数据
          this.debugInfo = "正在获取运势数据...";
          const res = await fetch('http://localhost:8000/fortune/1')
          if (!res.ok) throw new Error(`获取运势数据失败: ${res.status} ${res.statusText}`)
          this.fortune = await res.json()
          this.debugInfo = "运势数据获取成功: " + JSON.stringify(this.fortune);
          
          this.debugInfo = "正在获取穿搭数据...";
          const outfitRes = await fetch('http://localhost:8000/outfit/1')
          if (!outfitRes.ok) throw new Error(`获取穿搭数据失败: ${outfitRes.status} ${outfitRes.statusText}`)
          const outfitData = await outfitRes.json();
          this.outfit = outfitData.outfit || outfitData;
          this.debugInfo = "穿搭数据获取成功: " + JSON.stringify(outfitData);
          
          this.debugInfo = "正在获取穿搭图片...";
          const imageRes = await fetch('http://localhost:8000/outfit-image/1')
          if (!imageRes.ok) throw new Error(`获取穿搭图片失败: ${imageRes.status} ${imageRes.statusText}`)
          const imageData = await imageRes.json();
          this.outfitImage = imageData.image_url || imageData;
          this.debugInfo = "穿搭图片获取成功: " + JSON.stringify(imageData);
          
          this.debugInfo = "正在获取饮食数据...";
          const dietRes = await fetch('http://localhost:8000/diet/1')
          if (!dietRes.ok) throw new Error(`获取饮食数据失败: ${dietRes.status} ${dietRes.statusText}`)
          const dietData = await dietRes.json();
          this.diet = dietData.diet || dietData;
          this.debugInfo = "饮食数据获取成功: " + JSON.stringify(dietData);
        } catch (err) {
          console.error('Error fetching data:', err)
          this.error = '数据加载失败: ' + err.message + '。请确保后端服务正在运行且API密钥已设置。'
          this.debugInfo = "错误详情: " + err.message;
        } finally {
          this.loading = false
        }
      }
    }).mount('#app')
  </script>
</body>
</html>